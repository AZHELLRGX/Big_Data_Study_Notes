# ETL

## 你们业务库怎么同步到数仓的

> - Datax  主导了Datax的改造；Datax的设计思路很巧妙，采用了framework+plugins的开发模式，同步组件可插拔；另外有很好的线程模型设计，reader和writer解耦合，借助channel作为数据传输通道。 
>
> - Sqoop，主要在关系型数据库和HDFS之间同步数据

## 增量处理的逻辑说一下

> - 每天的新增数据作为一个分区，适用于表数据量比较大的场景，且每天只有新增数据的表
>
> - 与之类似的是新增及变化策略，要求数据存在新增时间或者变更时间

## 如果业务库修改了数据，但是更新时间没有修改，这个数据能抽过来吗？应该怎么处理

> 采用Binlog  CDC（flink CDC）change data capture 动态数据捕获

# 数据模型

## 工作中的一个主题建模过程



# 数仓分层

## 你们数仓分层怎么分的，每层的作用？

> - 因为主要给运行商提供服务，我们主要处理的是基站通信服务产生的数据，这些数据一般分为网络优化数据和定位数据；
>   - 网络优化的数据分层为厂商提供的原始数据（基站参数和性能数据）ods层，数据解码转换结果为dwd层，基站或者小区指标计算以及时空化汇聚结果为dws层；数据维度层DIM主要是是小区信息、基站信息、物业点信息等；因为是数据底座，所以数据到了dws就通过hive或者kafka共享了，ads和标签层等目前不由我们设计
>   - 后面这个定位的就带一下就行了，毕竟没有什么规划，分层确实不好分，定位类型数据主要有用户信令xdr数据，基站采样点mr数据，用户GPS定位mdt数据，这些数据均为ods层原始数据，数据简单过滤清洗后存放dwd层，上层进行数据的交互计算，多个计算步骤统一编排，输出的各种数据应该属于DWS层
>   - 常驻用户产品在这里应该也应该属于DWS层，毕竟也是一种较为复杂的数据关联和处理；ADS层则是基于这些数据计算出来的指标信息，比如弱覆盖占比，高精度常驻用户占比；而DIM层则是小区楼宇数据、小区工参信息、POI物业点信息，具体到高铁、地铁分析，高铁地铁的配置也是DIM维度表

## 为什么要分层，每层的作用是什么

**分层的意义**

- 清晰数据结构：每一个数据分层都有它的作用域，这样我们在使用表的时候能更方便地定位和理解。

- 数据血缘追踪：简单来讲可以这样理解，我们最终给业务呈现的是一张能直接使用的张业务表，但是它的来源有很多，如果有一张来源表出问题了，我们希望能够快速准确地定位到问题，并清楚它的危害范围。

- 减少重复开发：规范数据分层，开发一些通用的中间层数据，能够减少极大的重复计算。

- 把复杂问题简单化：将一个复杂的任务分解成多个步骤来完成，每一层只处理单一的步骤，比较简单和容易理解。而且便于维护数据的准确性，当数据出现问题之后，可以不用修复所有的数据，只需要从有问题的步骤开始修复。

- 屏蔽原始数据的异常：屏蔽业务的影响，不必改一次业务就需要重新接入数据。

**每层的作用：**

- ODS【Operation Data Store】层：贴原层，与业务源数据保持一致，不做任何处理
- CDM【Common Data Model】层：数据公共层，也可以称为通用数据模型层，包括
  - DIM维度表：基于维度建模理念思想，建立一致性维度
  - DWD明细数据层：对数据进行规范化编码转换，清洗，统一格式，脱敏等，不做
    横向整合  这一层一般分为多个业务主题域，每个主题域包含多个主题
  - DWS轻度汇总层：以分析的主题对象作为建模驱动，基于上层的应用和产品的
    指标需求，构建公共粒度的汇总指标事实表，以宽表化手段物理化模型。构建命名规范、口
    径一致的统计指标，为上层提供**公共**指标，建立汇总宽表、明细事实表     这一层一般分为多个分析主题域，每个主题域包含多个主题
- ADS【Application Data Service】：面向业务定制开发，存放数据产品个性化的统计指标数据；

## 数仓分层每层需要注意什么

- 一定要制订相关规范，比如表名称规范

- 注意不要超出当前层的作用域

- 注意数据的权限控制

## 你们数据域怎么划分的

回答一下运营商的数据域划分即可

- B域（业务域）=business support system的数据域，B域有用户数据和业务数据，比如用户的消费习惯、终端信息、ARPU的分组、业务内容，业务受众人群等。业务支持系统(BSS)主要实现了对电信业务、电信资费、电信营销的管理，以及对客户的管理和服务的过程，它所包含的主要系统包括：计费系统、客服系统、帐务系统、结算系统以及经营分析系统等。

- O域（运营域）=operation support system的数据域，O域有网络数据，比如信令、告警、故障、网络资源等。运营支撑系统(OSS)主要是面向资源（网络、设备、计算系统）的后台支撑系统，包括专业网络管理系统、综合网络管理系统、资源管理系统、业务开通系统、服务保障系统等，为网络可靠、安全和稳定运行提供支撑手段。
- M域（管理域）=management support system的数据域。M域有位置信息，比如人群流动轨迹、地图信息等。管理支持系统(MSS)，包括为支撑企业所需的所有非核心业务流程，内容涵盖制订公司战略和发展方向、企业风险管理、审计管理、公众宣传与形象管理、财务与资产管理、人力资源管理、知识与研发管理、股东与外部关系管理、采购管理、企业绩效评估、政府政策与法律等。

# 数据治理

## 数据治理怎么做的

## 元数据管理怎么做的

## 数据质量管理怎么做的

# Hive

## 你们使用宽表会有什么问题吗

> 宽表的定义：
>
> - 1、宽表，通常是指业务主题相关的指标、维度、属性关联在一起的一张数据库表。
> - 2、在数据仓库建设中，组织相关和相似数据，采用明细宽表，复用关联计算，减少数据扫描，提高明细数据表的易用性 
> - 3、 在汇总数据层，指标的维度退化，采取更多的宽表化手段构建公共指标数据层，提升公共指标的复用性，减少重复加工。
>
> 优缺点：
>
> - 优点：提高查询性能、快速响应、方便使用，降低使用成本、提高用户满意度 
> - 缺点： 由于把不同的内容都放在同一张表存储，宽表已经不符合三范式的模型设计规范，随之带来的主要坏处就是数据的大量冗余、 另外就是灵活性差，就比如说线上业务表结构变更，宽表模式改造量也比较大
>
> 建议使用宽表的场景：数据使用频次高、沟通成本高、主题层一般多使用宽表。
>
> 实际项目：具体到CMPM项目，只要厂商数据经常发生变更，虽然做了一定的兼容，但是由于客户有根据新增counter添加指标的需求，就可能导致我们的指标汇总层的宽表结构经常变更，不够灵活【这个例子可能举得不是很好】
>
> 可以从以下几点来讲遇到的问题：
>
> 1、有些宽表建立的时候，对表的使用频次预估不足，后续部分宽表废弃或者过了一段时间使用频次就降低了，这种属于短期需求完全可以使用其他方式代替 
>
> 2、数据权限不好控制，可能需要额外提供API来控制对数据的部分列的访问权限；无形的增加了数据共享成本

## hive这个组件产生的优点，与其他组件比较

> 1、数据存储在HDFS，有备份，天然高可用
>
> 2、借助廉价的磁盘资源，存储的数据可以认为是无限的【当然，元数据可能也会膨胀到难以管理的状态】
>
> 3、支持丰富的查询接口，JDBC、Thrift等接口或协议
>
> 4、支持丰富的SQL语句(遵循SQL92标准)；也可以自定义函数
>
> 与其他组件比较，主要是容易上手，会编写SQL的开发或者运维人员肯容易很快入门；另外其他组件例如HBase等或多或少都需要依赖内存，但是内存资源比硬盘要稀有

## 什么情况下会用到拉链表，拉链表的实现逻辑说一下

如果是比较关注数据的历史信息，并且想要看到数据的动态变化轨迹的，可以使用拉链表

拉链表其实就是对原数据添加StartDate和EndDate字段，表示在这个时间段内这条数据是有效的

- 如果查询当前所有有效的记录，则查询类似：select * from user where t_end_date = '9999-12-31'。
- 如果查询2017-01-02的历史快照，则select * from user where t_start_date <= '2017-01-02' and t_end_date >= '2017-01-02'。